<div class="container-fluid">
  <div class="row">
    <div class="col-md-4 col-md-offset-4">
      <div class="panel panel-primary">
        <div class="panel-heading"><h3>Обрані екіпажі</h3></div>
        <div class="panel-body">
          <p>Надайте наступну інформацію обраним екіпажам:</p>
            <ul class="unordered">

              <li><b>Місце злочину:</b> м. Київ ....</li>
              <li><b>Контактна особа:</b> <%= @claim.lastname %></li>
              <li><b>Телефон:</b> <%= @claim.phone %></li>
            </ul>


          <p>Відмітьте усі поля у таблиці та натисні кнопку продовжити.</p>

          <div class="row">
            <% @crews.each do |crew| %>
              <div class="col-lg-4">
                <div class="checkbox">
                  <input type="checkbox" id="<%= crew.crew_name %>" onclick="check_proceed()">
                  <label for="<%= crew.crew_name %>">Екіпаж: <b><%= crew.crew_name %></b></label>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <div class="panel-footer">
          <%= button_to "Завершити", root_path, id: "proceed_button", class: "btn btn-primary btn-lg  btn-block", method: :get, disabled: false %>
        </div>
      </div>
    </div>
  </div>
</div>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4LUweIm-L6Kr-V91-dwHXe3pclHfOV3M&callback=initMap&language=uk">
</script>

<script>
var geocoder;
google.maps.event.addDomListener(window, 'load', initialize);

window.onload = codeLatLng();

function initialize() {
  geocoder = new google.maps.Geocoder();
}

function check_proceed() {
  var count = $("[type='checkbox']:checked").length;
  console.log("PUSHED " + count);
  if (count == <%= @crews.count %>) {
    document.getElementById('proceed_button').disabled = false;
  } else {
    document.getElementById('proceed_button').disabled = true;
  }
};

function codeLatLng() {
  var latlng = new google.maps.LatLng(<%= @claim.latitude %>, <%= @claim.longitude %>);
  geocoder.geocode({
    'latLng': latlng
  }, function (results, status) {
    if (status === google.maps.GeocoderStatus.OK) {
      if (results[1]) {
        console.log(results[1]);
      } else {
        alert('No results found');
      }
    } else {
      alert('Geocoder failed due to: ' + status);
    }
  });
}

</script>
